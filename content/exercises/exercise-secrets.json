{
  "id": "exercise-secrets",
  "lessonId": "intermediate-secrets",
  "title": "Manage Sensitive Data with Secrets",
  "description": "Create and use Secrets to store sensitive information",
  "difficulty": "intermediate",
  "estimatedTime": 20,
  "steps": [
    {
      "id": "step-1",
      "order": 1,
      "instruction": "Create a Secret named 'db-credentials' with keys 'username=admin' and 'password=secretpass123'",
      "expectedOutcome": "Secret should be created with base64-encoded values",
      "hints": [
        "Use kubectl create secret generic db-credentials --from-literal=username=admin --from-literal=password=secretpass123",
        "Secrets are automatically base64-encoded by kubectl"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get secret db-credentials -o jsonpath='{.type}'",
            "expectedOutput": "Opaque"
          }
        ]
      }
    },
    {
      "id": "step-2",
      "order": 2,
      "instruction": "Create a Pod named 'secret-test' that mounts the Secret as environment variables",
      "expectedOutcome": "Pod should have access to the Secret values as environment variables",
      "hints": [
        "Use envFrom with secretRef in the Pod spec",
        "The pod should run a long-lived command to allow inspection"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get pod secret-test -o jsonpath='{.spec.containers[0].envFrom[0].secretRef.name}'",
            "expectedOutput": "db-credentials"
          }
        ]
      }
    },
    {
      "id": "step-3",
      "order": 3,
      "instruction": "Clean up by deleting the Secret and any pods using it.",
      "expectedOutcome": "Secret and pods should be deleted",
      "hints": [
        "Delete the Secret: kubectl delete secret db-credentials",
        "Delete any pods: kubectl delete pod --all",
        "Verify: kubectl get secrets,pods"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get secret db-credentials 2>&1 | grep -q \"NotFound\" && echo \"deleted\" || echo \"exists\"",
            "expectedOutput": "deleted"
          }
        ]
      }
    }
  ],
  "resources": [
    {
      "type": "yaml",
      "name": "secret-pod.yaml",
      "content": "apiVersion: v1\nkind: Pod\nmetadata:\n  name: secret-test\nspec:\n  containers:\n  - name: busybox\n    image: busybox:latest\n    command: ['sh', '-c', 'sleep 3600']\n    envFrom:\n    - secretRef:\n        name: db-credentials"
    }
  ]
}
