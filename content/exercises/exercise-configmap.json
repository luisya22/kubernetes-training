{
  "id": "exercise-configmap",
  "lessonId": "intermediate-configmaps",
  "title": "Use ConfigMaps for Application Configuration",
  "description": "Create ConfigMaps and inject configuration into Pods",
  "difficulty": "intermediate",
  "estimatedTime": 20,
  "steps": [
    {
      "id": "step-1",
      "order": 1,
      "instruction": "Create a ConfigMap named 'app-config' with keys 'database_url=postgres://db:5432/myapp' and 'log_level=debug'",
      "expectedOutcome": "ConfigMap should be created with the specified key-value pairs",
      "hints": [
        "Use kubectl create configmap app-config --from-literal=database_url=postgres://db:5432/myapp --from-literal=log_level=debug",
        "Or create a YAML manifest and apply it"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get configmap app-config -o jsonpath='{.data.database_url}'",
            "expectedOutput": "postgres://db:5432/myapp"
          },
          {
            "command": "kubectl get configmap app-config -o jsonpath='{.data.log_level}'",
            "expectedOutput": "debug"
          }
        ]
      }
    },
    {
      "id": "step-2",
      "order": 2,
      "instruction": "Create a Pod named 'config-test' running busybox that uses the ConfigMap as environment variables",
      "expectedOutcome": "Pod should have environment variables from the ConfigMap",
      "hints": [
        "Use envFrom in the Pod spec to load all ConfigMap keys as environment variables",
        "The pod should run a command like 'sleep 3600' to stay alive"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get pod config-test -o jsonpath='{.spec.containers[0].envFrom[0].configMapRef.name}'",
            "expectedOutput": "app-config"
          }
        ]
      }
    },
    {
      "id": "step-3",
      "order": 3,
      "instruction": "Clean up by deleting the ConfigMap and any pods using it.",
      "expectedOutcome": "ConfigMap and pods should be deleted",
      "hints": [
        "Delete the ConfigMap: kubectl delete configmap app-config",
        "Delete any pods: kubectl delete pod --all",
        "Verify: kubectl get configmaps,pods"
      ],
      "validation": {
        "type": "kubernetes",
        "checks": [
          {
            "command": "kubectl get configmap app-config 2>&1 | grep -q \"NotFound\" && echo \"deleted\" || echo \"exists\"",
            "expectedOutput": "deleted"
          }
        ]
      }
    }
  ],
  "resources": [
    {
      "type": "yaml",
      "name": "configmap-pod.yaml",
      "content": "apiVersion: v1\nkind: Pod\nmetadata:\n  name: config-test\nspec:\n  containers:\n  - name: busybox\n    image: busybox:latest\n    command: ['sh', '-c', 'sleep 3600']\n    envFrom:\n    - configMapRef:\n        name: app-config"
    }
  ]
}
