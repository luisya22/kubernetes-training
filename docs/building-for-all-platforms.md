# Building for All Platforms

This guide explains how to build the Kubernetes Training App for Windows, macOS, and Linux.

## Quick Start

### Local Build (Current Platform Only)

```bash
# Install dependencies
npm install

# Generate icons (first time only)
npm run icons

# Build and package for your current platform
npm run dist
```

The installer will be in the `release/` directory.

### Build for All Platforms (GitHub Actions)

The easiest way to build for all platforms is using GitHub Actions:

1. **Create a new release tag:**
   ```bash
   git tag v0.2.0
   git push origin v0.2.0
   ```

2. **GitHub Actions will automatically:**
   - Build on Windows, macOS, and Linux runners
   - Run tests
   - Create installers for all platforms
   - Attach them to the GitHub release

3. **Download installers from:**
   `https://github.com/YOUR_USERNAME/kubernetes-training/releases`

## Prerequisites

### All Platforms
- Node.js 18 or higher
- npm or yarn

### Platform-Specific Requirements

**Windows:**
- No additional requirements
- Can only build Windows installers locally

**macOS:**
- Xcode Command Line Tools
- Can build for macOS and Linux locally
- Cannot build Windows installers

**Linux:**
- Standard build tools (gcc, make)
- Can build for Linux locally
- Cannot build Windows or macOS installers

## Icon Generation

Before building, generate platform-specific icons:

```bash
npm run icons
```

This will:
- ✅ Generate Windows `.ico` from your PNG
- ℹ️ Provide instructions for macOS `.icns` conversion
- ✅ Verify Linux icons exist

### Manual Icon Creation

**For macOS (.icns):**
1. Visit https://cloudconvert.com/png-to-icns
2. Upload `build/icons/256x256.png`
3. Download and save as `build/icon.icns`

**For Windows (.ico):**
- Automatically generated by the script

**For Linux:**
- Use existing PNG files in `build/icons/`

## Build Commands

### Development Build
```bash
npm run build          # Build TypeScript and webpack bundles
npm start              # Run the app without packaging
```

### Production Packaging

```bash
# Current platform only
npm run package

# Specific platforms
npm run package:win    # Windows (NSIS installer)
npm run package:mac    # macOS (DMG for Intel + Apple Silicon)
npm run package:linux  # Linux (AppImage + deb)

# All platforms (macOS/Linux only)
npm run package:all

# Using the build script
npm run dist           # Current platform
node scripts/build-all.js windows
node scripts/build-all.js macos
node scripts/build-all.js linux
node scripts/build-all.js all
```

## Output Files

After building, check the `release/` directory:

**Windows:**
- `Kubernetes Training-Setup-0.1.0.exe` - NSIS installer

**macOS:**
- `Kubernetes Training-0.1.0-x64.dmg` - Intel Macs
- `Kubernetes Training-0.1.0-arm64.dmg` - Apple Silicon

**Linux:**
- `Kubernetes Training-0.1.0-x64.AppImage` - Universal (recommended)
- `Kubernetes Training-0.1.0-x64.deb` - Debian/Ubuntu

## GitHub Actions Workflow

The project includes a complete CI/CD pipeline in `.github/workflows/build.yml`:

### Triggers
- **Push to main:** Builds all platforms, uploads artifacts
- **Pull requests:** Runs tests only
- **Tags (v*):** Builds all platforms + creates GitHub release

### What It Does

1. **Test Job** (PRs only)
   - Runs on Ubuntu
   - Executes `npm test`

2. **Build Job** (All events)
   - Runs on Windows, macOS, and Linux in parallel
   - Installs dependencies
   - Builds the application
   - Packages platform-specific installers
   - Uploads artifacts

3. **Release Job** (Tags only)
   - Downloads all artifacts
   - Creates GitHub release
   - Attaches installers
   - Generates release notes

### Creating a Release

```bash
# 1. Update version in package.json
npm version patch  # or minor, major

# 2. Commit changes
git add package.json package-lock.json
git commit -m "Bump version to 0.2.0"

# 3. Create and push tag
git tag v0.2.0
git push origin main
git push origin v0.2.0

# 4. Wait for GitHub Actions to complete
# 5. Check releases page for installers
```

## Troubleshooting

### "Cannot build for X platform on Y"
- **Solution:** Use GitHub Actions for cross-platform builds
- Windows can only build Windows installers
- macOS/Linux can build for themselves + each other

### "Icon file not found"
- **Solution:** Run `npm run icons` first
- Manually create missing icons (see Icon Generation section)

### "electron-builder failed"
- Check that `dist/` directory exists and contains built files
- Run `npm run build` first
- Verify `package.json` build configuration

### "GitHub Actions failing"
- Check that all required files are committed
- Verify `build/` directory contains icons
- Check workflow logs for specific errors

### "Release not created"
- Ensure tag starts with `v` (e.g., `v0.1.0`)
- Check GitHub Actions permissions
- Verify `GITHUB_TOKEN` is available

## Build Configuration

The build configuration is in `package.json` under the `build` key:

```json
{
  "build": {
    "appId": "com.kubernetes.training",
    "productName": "Kubernetes Training",
    "directories": {
      "output": "release",
      "buildResources": "build"
    },
    "files": ["dist/**/*", "content/**/*", "package.json"],
    "extraResources": [
      {
        "from": "content",
        "to": "content",
        "filter": ["**/*"]
      }
    ]
  }
}
```

### Key Settings

- **appId:** Unique identifier for the app
- **productName:** Display name in installers
- **files:** What gets included in the package
- **extraResources:** Additional files (lessons, exercises)
- **win/mac/linux:** Platform-specific settings

## Advanced: Custom Build Options

### Change Output Directory
```json
"build": {
  "directories": {
    "output": "dist-packages"
  }
}
```

### Add More Formats
```json
"linux": {
  "target": ["AppImage", "deb", "rpm", "snap"]
}
```

### Code Signing (macOS/Windows)
```json
"mac": {
  "identity": "Developer ID Application: Your Name"
},
"win": {
  "certificateFile": "path/to/cert.pfx",
  "certificatePassword": "password"
}
```

## Resources

- [electron-builder docs](https://www.electron.build/)
- [GitHub Actions docs](https://docs.github.com/en/actions)
- [Electron packaging guide](https://www.electronjs.org/docs/latest/tutorial/application-distribution)

## Summary

- **Local development:** `npm run dist`
- **Production releases:** Push a tag, let GitHub Actions handle it
- **Cross-platform:** Always use GitHub Actions
- **Icons:** Run `npm run icons` before first build
